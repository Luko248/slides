---
import { tv } from "tailwind-variants";

interface Props {
  title?: string;
  desc?: string;
  image?: {
    url: string;
    width?: number;
    height?: number;
    alt?: string;
  };
  centerContent?: boolean;
  speaker?: boolean;
}

const { title, desc, image, centerContent, speaker } = Astro.props;

const slideVariants = tv({
  base: "h-svh grid gap-[8svb] p-[8svb] bg-white/90 backdrop-blur-lg relative z-50",
  variants: {
    layout: {
      default: "content-start",
      center: "content-center",
      speaker: "grid-rows-[auto_1fr] content-start",
    },
  },
  defaultVariants: {
    layout: "default",
  },
});

const titleVariants = tv({
  base: "font-bold text-theme-500",
  variants: {
    size: {
      default: "text-6xl",
      large: "text-8xl text-center",
    },
  },
  defaultVariants: {
    size: "default",
  },
});

const contentVariants = tv({
  base: "max-w-none left",
  variants: {
    span: {
      default: "",
      full: "col-span-2",
    },
    type: {
      default: "",
      speaker: "self-start",
    },
  },
  defaultVariants: {
    span: "default",
    type: "default",
  },
});

const getLayoutVariant = () => {
  if (speaker) return "speaker";
  if (centerContent) return "center";
  return "default";
};
---

<style>
  section {
    container-type: scroll-state;
    scroll-snap-align: center;
    scroll-snap-stop: always;
    counter-increment: slides-counter;

    &::scroll-marker {
      color: transparent;
      text-decoration: 0;
      line-height: 1;
      content: counter(slides-counter);
      background-color: var(--marker-bg, var(--black-trans));
      inline-size: 1rem;
      block-size: 1rem;
      font-size: 0.65em;
      display: grid;
      place-items: center;
      box-sizing: border-box;
      border-radius: 100vmax;
      border: 2px solid var(--color-theme-500);
      scale: 1;
      z-index: 1;
      transition:
        scale 0.3s ease,
        color 0.3s ease,
        background-color 0.3s ease;
    }

    &::scroll-marker:target-current {
      --marker-bg: var(--color-theme-500);
      color: white;
      opacity: 1;
      scale: 1.5;
      z-index: 2;
    }
    :is(.top, .left, .right) {
      opacity: 0;
      transition: opacity 200ms ease-in;

      @container scroll-state(snapped: block) {
        opacity: 1;
      }
    }
    .top {
      transition-delay: 400ms;
    }

    .left {
      transition-delay: 600ms;
    }
    .right {
      transition-delay: 800ms;
    }
  }
</style>

<section class={slideVariants({ layout: getLayoutVariant() })}>
  <div class="top">
    <h2 class={titleVariants({ size: centerContent ? "large" : "default" })}>
      <slot name="title">{title}</slot>
      {
        desc && (
          <small class="text-theme-500 font-semibold block mt-[.5em] text-[.5em]">
            {desc}
          </small>
        )
      }
    </h2>
  </div>

  <div class="grid grid-cols-[7fr_5fr] gap-[8svb] align-center">
    <div
      class={contentVariants({
        span: centerContent ? "full" : "default",
        type: speaker ? "speaker" : "default",
      })}
    >
      <slot name="left">
        <slot />
      </slot>
    </div>
    <div class="right relative grid items-center">
      <slot name="right">
        {
          image && (
            <img
              src={image.url}
              alt={image.alt}
              width={image.width}
              height={image.height}
              class="max-h-[70svb] object-contain w-auto absolute rounded-[.5em] border-[3px] border-theme-500"
            />
          )
        }
      </slot>
    </div>
  </div>
</section>
